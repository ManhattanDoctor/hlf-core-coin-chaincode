# HLF Core Coin Chaincode

[![TypeScript](https://img.shields.io/badge/TypeScript-007ACC?style=flat-square&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Hyperledger Fabric](https://img.shields.io/badge/Hyperledger%20Fabric-2F4F4F?style=flat-square&logo=hyperledger&logoColor=white)](https://hyperledger-fabric.readthedocs.io/)

–ú–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞–º–∏ (–º–æ–Ω–µ—Ç–∞–º–∏) –∏ –∏—Ö —Å—á–µ—Ç–∞–º–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω-—Å—Ä–µ–¥–µ Hyperledger Fabric. –†–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è, —ç–º–∏—Å—Å–∏–∏, –ø–µ—Ä–µ–≤–æ–¥–∞, —É–¥–µ—Ä–∂–∞–Ω–∏—è –∏ —Å–∂–∏–≥–∞–Ω–∏—è —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –∞–∫—Ç–∏–≤–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–æ–±—ã—Ç–∏–π –∏ —Å—Ç—Ä–æ–≥–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ü–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ç–æ–∫–µ–Ω–æ–≤**: —Å–æ–∑–¥–∞–Ω–∏–µ, —ç–º–∏—Å—Å–∏—è, —Å–∂–∏–≥–∞–Ω–∏–µ, –ø–µ—Ä–µ–≤–æ–¥
- **–°–∏—Å—Ç–µ–º–∞ —É–¥–µ—Ä–∂–∞–Ω–∏—è (hold)**: –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- **–ì–∏–±–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- **–°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è**: –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TypeScript
- **–°–æ–±—ã—Ç–∏–π–Ω–∞—è –º–æ–¥–µ–ª—å**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –≥–∞—Ä–∞–Ω—Ç–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- [DTO –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã](#dto-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)
- [–°–æ–±—ã—Ç–∏—è](#—Å–æ–±—ã—Ç–∏—è)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install @hlf-core/coin-chaincode
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```json
{
  "@hlf-core/coin": "~3.2.29",
  "@hlf-core/chaincode": "~3.6.1",
  "@ts-core/common": "^1.0.0",
  "lodash": "^4.17.21"
}
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```typescript
import { CoinService, CoinManager } from '@hlf-core/coin-chaincode';
import { ILogger, IStub } from '@ts-core/common';

// –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
const logger: ILogger = /* –≤–∞—à –ª–æ–≥–≥–µ—Ä */;
const service = new CoinService(logger);

// –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
const stub: IStub = /* –≤–∞—à stub */;
const manager = new CoinManager(logger, stub);

// –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω–µ—Ç—ã
const coin = manager.create('MYCOIN', 18, 'owner-uid');

// –≠–º–∏—Å—Å–∏—è —Ç–æ–∫–µ–Ω–æ–≤
await manager.emit(coin, 'user-uid', '1000');

// –ü–µ—Ä–µ–≤–æ–¥ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
await manager.transfer(coin, 'user-uid', 'another-user-uid', '100');
```

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. **CoinManager** - –û—Å–Ω–æ–≤–Ω–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–Ω–µ—Ç
```typescript
class CoinManager<T extends ICoin = ICoin> extends EntityManagerImpl<T>
```
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –º–æ–Ω–µ—Ç
- –†–µ–∞–ª–∏–∑—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç–æ–∫–µ–Ω–∞–º–∏
- –†–∞–±–æ—Ç–∞–µ—Ç —Å CoinAccountManager –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞–º–∏

#### 2. **CoinAccountManager** - –ú–µ–Ω–µ–¥–∂–µ—Ä —Å—á–µ—Ç–æ–≤
```typescript
class CoinAccountManager extends EntityManagerImpl<CoinAccount>
```
- –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å—á–µ—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–Ω–µ—Ç—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç –ø—É—Å—Ç—ã–µ —Å—á–µ—Ç–∞
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–ª–∞–Ω—Å–∞–º–∏

#### 3. **CoinService** - –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π
```typescript
class CoinService<H extends IStubHolder = IStubHolder> extends LoggerWrapper
```
- –§–∞—Å–∞–¥ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –î–∏—Å–ø–∞—Ç—á–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### 4. **Error Classes** - –°–∏—Å—Ç–µ–º–∞ –æ—à–∏–±–æ–∫
```typescript
class CoinNotFoundError extends Error<string>
class CoinObjectNotFoundError extends Error<string>
class CoinFromToEqualsError extends Error<string>
```

### –î–∏–∞–≥—Ä–∞–º–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   CoinService   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   CoinManager    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ CoinAccountMgr  ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                  ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ –í–∞–ª–∏–¥–∞—Ü–∏—è     ‚îÇ    ‚îÇ ‚Ä¢ CRUD –º–æ–Ω–µ—Ç     ‚îÇ    ‚îÇ ‚Ä¢ CRUD —Å—á–µ—Ç–æ–≤   ‚îÇ
‚îÇ ‚Ä¢ –°–æ–±—ã—Ç–∏—è       ‚îÇ    ‚îÇ ‚Ä¢ –û–ø–µ—Ä–∞—Ü–∏–∏       ‚îÇ    ‚îÇ ‚Ä¢ –ë–∞–ª–∞–Ω—Å—ã       ‚îÇ
‚îÇ ‚Ä¢ –û—à–∏–±–∫–∏        ‚îÇ    ‚îÇ ‚Ä¢ –ü–µ—Ä–µ–≤–æ–¥—ã       ‚îÇ    ‚îÇ ‚Ä¢ –£–¥–µ—Ä–∂–∞–Ω–∏—è     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   IStub/State   ‚îÇ
                    ‚îÇ                 ‚îÇ
                    ‚îÇ ‚Ä¢ –ë–ª–æ–∫—á–µ–π–Ω      ‚îÇ
                    ‚îÇ ‚Ä¢ –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### CoinManager

#### –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

```typescript
// –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω–µ—Ç—ã
create(coinId: string, decimals: number, owner: UID): T

// –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–Ω–µ—Ç—ã
get(item: UID, details?: Array<keyof ICoin>): Promise<T>

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–Ω–µ—Ç—ã
save(item: T): Promise<T>

// –£–¥–∞–ª–µ–Ω–∏–µ –º–æ–Ω–µ—Ç—ã –∏ –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—á–µ—Ç–æ–≤
remove(item: UID): Promise<void>
```

#### –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç–æ–∫–µ–Ω–∞–º–∏

```typescript
// –≠–º–∏—Å—Å–∏—è —Ç–æ–∫–µ–Ω–æ–≤
emit(coin: T | string, objectUid: string, value: string): Promise<ICoinMovement>
emitHeld(coin: T | string, objectUid: string, value: string): Promise<ICoinMovement>

// –°–∂–∏–≥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
burn(coin: T | string, objectUid: string, value: string): Promise<ICoinMovement>
burnHeld(coin: T | string, objectUid: string, value: string): Promise<ICoinMovement>

// –£–¥–µ—Ä–∂–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (hold)
hold(coin: T | string, objectUid: string, value: string): Promise<ICoinMovement>
unhold(coin: T | string, objectUid: string, value: string): Promise<ICoinMovement>

// –ù—É–ª–∏—Ñ–∏–∫–∞—Ü–∏—è (–æ–±–Ω—É–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞)
nullify(coin: T | string, objectUid: string): Promise<ICoinNullify>
nullifyHeld(coin: T | string, objectUid: string): Promise<ICoinNullify>

// –ü–µ—Ä–µ–≤–æ–¥—ã
transfer(coin: T | string, objectUid: string, targetUid: string, value: string): Promise<ICoinTransfer>
transferToHeld(coin: T | string, objectUid: string, targetUid: string, value: string): Promise<ICoinTransfer>
transferFromHeld(coin: T | string, objectUid: string, targetUid: string, value: string): Promise<ICoinTransfer>
transferFromToHeld(coin: T | string, objectUid: string, targetUid: string, value: string): Promise<ICoinTransfer>
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `coin` - UID –º–æ–Ω–µ—Ç—ã –∏–ª–∏ –æ–±—ä–µ–∫—Ç –º–æ–Ω–µ—Ç—ã
- `objectUid` - UID –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (–¥–ª—è transfer –æ–ø–µ—Ä–∞—Ü–∏–π)
- `targetUid` - UID –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–¥–ª—è transfer –æ–ø–µ—Ä–∞—Ü–∏–π)
- `value` - –°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Å—Ç—Ä–æ–∫–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

#### –†–∞–±–æ—Ç–∞ —Å–æ —Å—á–µ—Ç–∞–º–∏

```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—á–µ—Ç–∞
accountGet(coin: UID, object: UID): Promise<ICoinAccount>

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞
accountSet(item: ICoinAccount): Promise<ICoinAccount>

// –°–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤ –º–æ–Ω–µ—Ç—ã
accountList(coin: UID): Promise<Array<ICoinAccount>>
```

### CoinService

#### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

```typescript
// –≠–º–∏—Å—Å–∏—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ —Å–æ–±—ã—Ç–∏—è–º–∏
emit(holder: H, params: ICoinEmitDto, isDispatchEvent: boolean): Promise<void>
emitHeld(holder: H, params: ICoinEmitDto, isDispatchEvent: boolean): Promise<void>

// –°–∂–∏–≥–∞–Ω–∏–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ —Å–æ–±—ã—Ç–∏—è–º–∏
burn(holder: H, params: ICoinBurnDto, isDispatchEvent: boolean): Promise<void>
burnHeld(holder: H, params: ICoinBurnDto, isDispatchEvent: boolean): Promise<void>

// –ù—É–ª–∏—Ñ–∏–∫–∞—Ü–∏—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ —Å–æ–±—ã—Ç–∏—è–º–∏
nullify(holder: H, params: ICoinNullifyDto, isDispatchEvent: boolean): Promise<void>
nullifyHeld(holder: H, params: ICoinNullifyDto, isDispatchEvent: boolean): Promise<void>

// –£–¥–µ—Ä–∂–∞–Ω–∏–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ —Å–æ–±—ã—Ç–∏—è–º–∏
hold(holder: H, params: ICoinHoldDto, isDispatchEvent: boolean): Promise<void>
unhold(holder: H, params: ICoinUnholdDto, isDispatchEvent: boolean): Promise<void>

// –ü–µ—Ä–µ–≤–æ–¥—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ —Å–æ–±—ã—Ç–∏—è–º–∏
transfer(holder: H, params: ICoinTransferDto, isDispatchEvent: boolean): Promise<void>
transferToHeld(holder: H, params: ICoinTransferDto, isDispatchEvent: boolean): Promise<void>
transferFromHeld(holder: H, params: ICoinTransferDto, isDispatchEvent: boolean): Promise<void>
transferFromToHeld(holder: H, params: ICoinTransferDto, isDispatchEvent: boolean): Promise<void>

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
get<T extends ICoin>(holder: H, params: ICoinGetDto): Promise<T>
balanceGet(holder: H, params: ICoinBalanceGetDto): Promise<ICoinBalanceGetDtoResponse>
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `holder` - –û–±—ä–µ–∫—Ç —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ stub (IStubHolder)
- `params` - DTO —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `isDispatchEvent` - –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ª–∏ —Å–æ–±—ã—Ç–∏—è

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–∫–µ–Ω–∞

```typescript
import { CoinService, CoinManager } from '@hlf-core/coin-chaincode';

const service = new CoinService(logger);
const manager = new CoinManager(logger, stub);

// –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —Å 18 –∑–Ω–∞–∫–∞–º–∏ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
const token = manager.create('USDT', 18, 'issuer-uid');
await manager.save(token);

console.log(`–°–æ–∑–¥–∞–Ω —Ç–æ–∫–µ–Ω: ${token.id}, –≤–ª–∞–¥–µ–ª–µ—Ü: ${token.owner}`);
```

### –≠–º–∏—Å—Å–∏—è –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

```typescript
// –≠–º–∏—Å—Å–∏—è 1,000,000 —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ —Å—á–µ—Ç —ç–º–∏—Ç–µ–Ω—Ç–∞
await service.emit(holder, {
    coinUid: token.uid,
    objectUid: 'issuer-uid',
    value: '1000000'
}, true);

// –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
const users = ['user1', 'user2', 'user3'];
for (const user of users) {
    await service.transfer(holder, {
        coinUid: token.uid,
        objectUid: 'issuer-uid',
        targetUid: user,
        value: '1000',
        initiatorUid: 'issuer-uid'
    }, true);
}
```

### –°–∏—Å—Ç–µ–º–∞ —É–¥–µ—Ä–∂–∞–Ω–∏—è (escrow)

```typescript
// –£–¥–µ—Ä–∂–∞–Ω–∏–µ 100 —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ —Å—á–µ—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
await service.hold(holder, {
    coinUid: token.uid,
    objectUid: 'user1',
    value: '100',
    initiatorUid: 'escrow-service'
}, true);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ (–≤–∫–ª—é—á–∞—è —É–¥–µ—Ä–∂–∞–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞)
const balance = await service.balanceGet(holder, {
    coinUid: token.uid,
    objectUid: 'user1'
});

console.log(`–î–æ—Å—Ç—É–ø–Ω–æ: ${balance.inUse}, —É–¥–µ—Ä–∂–∞–Ω–æ: ${balance.held}, –≤—Å–µ–≥–æ: ${balance.total}`);

// –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —É–¥–µ—Ä–∂–∞–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
await service.unhold(holder, {
    coinUid: token.uid,
    objectUid: 'user1',
    value: '100',
    initiatorUid: 'escrow-service'
}, true);
```

### –°–ª–æ–∂–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã

```typescript
// –ü–µ—Ä–µ–≤–æ–¥ –∏–∑ —É–¥–µ—Ä–∂–∞–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –≤ –æ–±—ã—á–Ω—ã–µ
await service.transferFromHeld(holder, {
    coinUid: token.uid,
    objectUid: 'user1',
    targetUid: 'user2',
    value: '50',
    initiatorUid: 'payment-service'
}, true);

// –ü–µ—Ä–µ–≤–æ–¥ –≤ —É–¥–µ—Ä–∂–∞–Ω–∏–µ
await service.transferToHeld(holder, {
    coinUid: token.uid,
    objectUid: 'user2',
    targetUid: 'user3',
    value: '25',
    initiatorUid: 'escrow-service'
}, true);

// –ü–µ—Ä–µ–≤–æ–¥ –∏–∑ —É–¥–µ—Ä–∂–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –≤ —É–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
await service.transferFromToHeld(holder, {
    coinUid: token.uid,
    objectUid: 'user3',
    targetUid: 'user1',
    value: '10',
    initiatorUid: 'escrow-service'
}, true);
```

### –ù—É–ª–∏—Ñ–∏–∫–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–æ–≤

```typescript
// –û–±–Ω—É–ª–∏—Ç—å –æ–±—ã—á–Ω—ã–π –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
await service.nullify(holder, {
    coinUid: token.uid,
    objectUid: 'user1'
}, true);

// –û–±–Ω—É–ª–∏—Ç—å —É–¥–µ—Ä–∂–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å
await service.nullifyHeld(holder, {
    coinUid: token.uid,
    objectUid: 'user1'
}, true);
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```typescript
import { CoinNotFoundError, CoinFromToEqualsError } from '@hlf-core/coin-chaincode';

try {
    await service.transfer(holder, {
        coinUid: 'non-existent-coin',
        objectUid: 'user1',
        targetUid: 'user2',
        value: '100',
        initiatorUid: 'user1'
    }, true);
} catch (error) {
    if (CoinNotFoundError.instanceOf(error)) {
        console.error('–ú–æ–Ω–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', error.details);
    } else if (CoinFromToEqualsError.instanceOf(error)) {
        console.error('–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ:', error.details);
    } else {
        console.error('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
    }
}
```

## üì¶ DTO –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### ICoinTransferDto
```typescript
interface ICoinTransferDto {
    coinUid: string;        // UID –º–æ–Ω–µ—Ç—ã
    objectUid: string;      // UID –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
    targetUid: string;      // UID –ø–æ–ª—É—á–∞—Ç–µ–ª—è
    value: string;          // –°—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞
    initiatorUid?: string;  // UID –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
}
```

### ICoinEmitDto / ICoinBurnDto
```typescript
interface ICoinEmitDto {
    coinUid: string;        // UID –º–æ–Ω–µ—Ç—ã
    objectUid: string;      // UID –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–¥–ª—è emit) / –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (–¥–ª—è burn)
    value: string;          // –°—É–º–º–∞ —ç–º–∏—Å—Å–∏–∏/—Å–∂–∏–≥–∞–Ω–∏—è
    initiatorUid?: string;  // UID –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
}
```

### ICoinHoldDto / ICoinUnholdDto
```typescript
interface ICoinHoldDto {
    coinUid: string;        // UID –º–æ–Ω–µ—Ç—ã
    objectUid: string;      // UID –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Å—Ä–µ–¥—Å—Ç–≤
    value: string;          // –°—É–º–º–∞ —É–¥–µ—Ä–∂–∞–Ω–∏—è/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    initiatorUid?: string;  // UID –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
}
```

### ICoinNullifyDto
```typescript
interface ICoinNullifyDto {
    coinUid: string;        // UID –º–æ–Ω–µ—Ç—ã
    objectUid: string;      // UID –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Å—á–µ—Ç–∞
}
```

### ICoinBalanceGetDto
```typescript
interface ICoinBalanceGetDto {
    coinUid: string;        // UID –º–æ–Ω–µ—Ç—ã
    objectUid: string;      // UID –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Å—á–µ—Ç–∞
}
```

### ICoinBalanceGetDtoResponse
```typescript
interface ICoinBalanceGetDtoResponse {
    inUse: string;          // –î–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å
    held: string;           // –£–¥–µ—Ä–∂–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å
    total: string;          // –û–±—â–∏–π –±–∞–ª–∞–Ω—Å (inUse + held)
}
```

## üì° –°–æ–±—ã—Ç–∏—è

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏:

### CoinEmittedEvent
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —ç–º–∏—Å—Å–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ (emit/emitHeld).
```typescript
{
    coinUid: string;
    objectUid: string;
    value: string;
}
```

### CoinBurnedEvent
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Å–∂–∏–≥–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ (burn/burnHeld).
```typescript
{
    coinUid: string;
    objectUid: string;
    value: string;
}
```

### CoinTransferredEvent
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ —Ç–æ–∫–µ–Ω–æ–≤.
```typescript
{
    coinUid: string;
    objectUid: string;
    targetUid: string;
    value: string;
    initiatorUid?: string;
}
```

### CoinHoldedEvent
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —É–¥–µ—Ä–∂–∞–Ω–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤.
```typescript
{
    coinUid: string;
    objectUid: string;
    value: string;
    initiatorUid?: string;
}
```

### CoinUnholdedEvent
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ —É–¥–µ—Ä–∂–∞–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤.
```typescript
{
    coinUid: string;
    objectUid: string;
    value: string;
    initiatorUid?: string;
}
```

### CoinNullifiedEvent
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –Ω—É–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –±–∞–ª–∞–Ω—Å–∞.
```typescript
{
    coinUid: string;
    objectUid: string;
}
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ CoinManager.ts          # –û—Å–Ω–æ–≤–Ω–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–Ω–µ—Ç
‚îú‚îÄ‚îÄ CoinAccountManager.ts   # –ú–µ–Ω–µ–¥–∂–µ—Ä —Å—á–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ CoinService.ts          # –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π
‚îú‚îÄ‚îÄ ICoinManager.ts         # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–µ–Ω–µ–¥–∂–µ—Ä–∞
‚îú‚îÄ‚îÄ Error.ts                # –ö–∞—Å—Ç–æ–º–Ω—ã–µ –æ—à–∏–±–∫–∏
‚îî‚îÄ‚îÄ public-api.ts           # –ü—É–±–ª–∏—á–Ω—ã–π API
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã

- **CoinManager.ts** - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –º–æ–Ω–µ—Ç–∞–º–∏
- **CoinAccountManager.ts** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **CoinService.ts** - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ —Å–æ–±—ã—Ç–∏—è–º–∏
- **ICoinManager.ts** - –ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –º–æ–Ω–µ—Ç
- **Error.ts** - –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### –°–±–æ—Ä–∫–∞

```bash
npm run build
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
npm test
```

### –õ–∏–Ω—Ç–∏–Ω–≥

```bash
npm run lint
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ - —ç—Ç–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ –∫–æ–¥–∞
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ endorsement policy —Å–µ—Ç–∏ Hyperledger Fabric
- –í–∞–ª–∏–¥–∞—Ü–∏—è amount/value –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ CoinAccount

### –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å
- –û–ø–µ—Ä–∞—Ü–∏–∏ transfer –≤—ã–ø–æ–ª–Ω—è—é—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ read/write –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ read-write sets –º–µ—Ö–∞–Ω–∏–∑–º Hyperledger Fabric
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ MVCC_READ_CONFLICT

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ú–µ—Ç–æ–¥—ã transfer –¥–µ–ª–∞—é—Ç 6+ –æ–ø–µ—Ä–∞—Ü–∏–π —Å state
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –±–∞—Ç—á–∏–Ω–≥ –æ–ø–µ—Ä–∞—Ü–∏–π –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- –ü—É—Å—Ç—ã–µ —Å—á–µ—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ ISC License - —Å–º. —Ñ–∞–π–ª [LICENSE](LICENSE) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [Issues](../../issues) –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–æ–±–ª–µ–º
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Issue —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º
3. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

**Renat Gubaev**
üìß Email: [renat.gubaev@gmail.com](mailto:renat.gubaev@gmail.com)
üêô GitHub: [@ManhattanDoctor](https://github.com/ManhattanDoctor)

---

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è Hyperledger Fabric —Å–æ–æ–±—â–µ—Å—Ç–≤–∞**
